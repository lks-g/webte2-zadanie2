<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/styles.css">
    <title>Test API</title>
</head>

<body>
    <nav class="navbar navbar-expand-md bg-dark navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="../index.php">Lunch Menus</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="../php/api_doc.php">API</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../php/validate.php">Validate API</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Test API</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container my-5">
        <div class="row">
            <div class="col-lg-8">
                <h1 class="mb-4">Lunch Menu</h1>
                <div id="lunch-menu"></div>
            </div>
            <div class="col-lg-4">
                <h2 class="mb-4">Add an item to the menu:</h2>
                <form>
                    <div class="form-group">
                        <label for="item-name">Name</label>
                        <input type="text" class="form-control" id="item-name" name="item-name" required>
                    </div>
                    <div class="form-group">
                        <label for="item-price">Price</label>
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text">$</span>
                            </div>
                            <input type="number" class="form-control" id="item-price" name="item-price" step="0.01"
                                required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Item</button>
                </form>
            </div>
        </div>
    </div>

    <div id="testing">
        <h1>Test API</h1>

        <h2>Get all menus</h2>
        <button onclick="getMenus()">Get menus</button>
        <div id="menus"></div>

        <h2>Get menu by ID</h2>
        <label for="menuId">Menu ID:</label>
        <input type="text" id="menuId">
        <button onclick="getMenuById()">Get menu</button>
        <div id="menu"></div>

        <h2>Create menu</h2>
        <label for="providerId">Provider ID:</label>
        <input type="text" id="providerId"><br>
        <label for="menuDate">Menu date:</label>
        <input type="text" id="menuDate"><br>
        <label for="sourceCode">Source code:</label>
        <input type="text" id="sourceCode"><br>
        <label for="downloadDate">Download date:</label>
        <input type="text" id="downloadDate"><br>
        <button onclick="createMenu()">Create menu</button>
        <div id="createResult"></div>

        <h2>Update menu</h2>
        <label for="updateMenuId">Menu ID:</label>
        <input type="text" id="updateMenuId"><br>
        <label for="updateProviderId">Provider ID:</label>
        <input type="text" id="updateProviderId"><br>
        <label for="updateMenuDate">Menu date:</label>
        <input type="text" id="updateMenuDate"><br>
        <label for="updateSourceCode">Source code:</label>
        <input type="text" id="updateSourceCode"><br>
        <label for="updateDownloadDate">Download date:</label>
        <input type="text" id="updateDownloadDate"><br>
        <button onclick="updateMenu()">Update menu</button>
        <div id="updateResult"></div>

        <h2>Delete menu</h2>
        <label for="deleteMenuId">Menu ID:</label>
        <input type="text" id="deleteMenuId">
        <button onclick="deleteMenu()">Delete menu</button>
        <div id="deleteResult"></div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"></script>
    <script>
        const form = document.querySelector('form');
        const itemNameInput = document.getElementById('item-name');
        const itemPriceInput = document.getElementById('item-price');

        // Handle form submission
        form.addEventListener('submit', (e) => {
            e.preventDefault();

            const itemName = itemNameInput.value;
            const itemPrice = itemPriceInput.value;

            axios.post('http://rest-be/api/v1/restaurants/', {
                name: itemName,
                price: itemPrice,
            })
                .then((response) => {
                    console.log(response);
                    alert('Menu item added successfully!');
                })
                .catch((error) => {
                    console.error(error);
                    alert('Failed to add menu item!');
                })
                .finally(() => {
                    itemNameInput.value = '';
                    itemPriceInput.value = '';
                });
        });

        // Function to display all menus
        function getMenus() {
            axios.get('http://rest-be/api/v1/restaurants/')
                .then((response) => {
                    console.log(response);
                    const menusDiv = document.getElementById('menus');
                    menusDiv.innerHTML = JSON.stringify(response.data);
                })
                .catch((error) => {
                    console.error(error);
                    alert('Failed to get menus!');
                });
        }

        // Function to display menu by ID
        function getMenuById() {
            const menuId = document.getElementById('menuId').value;
            axios.get(`http://rest-be/api/v1/restaurants/${menuId}`)
                .then((response) => {
                    console.log(response);
                    const menuDiv = document.getElementById('menu');
                    menuDiv.innerHTML = JSON.stringify(response.data);
                })
                .catch((error) => {
                    console.error(error);
                    alert('Failed to get menu!');
                });
        }

        // Function to create a menu
        function createMenu() {
            const providerId = document.getElementById('providerId').value;
            const menuDate = document.getElementById('menuDate').value;
            const sourceCode = document.getElementById('sourceCode').value;
            const downloadDate = document.getElementById('downloadDate').value;
            axios.post('http://rest-be/api/v1/restaurants/', {
                providerId: providerId,
                date: menuDate,
                sourceCode: sourceCode,
                downloadDate: downloadDate,
            })
                .then((response) => {
                    console.log(response);
                    const createResultDiv = document.getElementById('createResult');
                    createResultDiv.innerHTML = JSON.stringify(response.data);
                    alert('Menu created successfully!');
                })
                .catch((error) => {
                    console.error(error);
                    alert('Failed to create menu!');
                });
        }

        // Function to update a menu
        function updateMenu() {
            const updateMenuId = document.getElementById('updateMenuId').value;
            const updateProviderId = document.getElementById('updateProviderId').value;
            const updateMenuDate = document.getElementById('updateMenuDate').value;
            const updateSourceCode = document.getElementById('updateSourceCode').value;
            const updateDownloadDate = document.getElementById('updateDownloadDate').value;
            axios.put(`http://rest-be/api/v1/restaurants/${updateMenuId}`, {
                providerId: updateProviderId,
                date: updateMenuDate,
                sourceCode: updateSourceCode,
                downloadDate: updateDownloadDate,
            })
                .then((response) => {
                    console.log(response);
                    const updateResultDiv = document.getElementById('updateResult');
                    updateResultDiv.innerHTML = JSON.stringify(response.data);
                    alert('Menu updated successfully!');
                })
                .catch((error) => {
                    console.error(error);
                    alert('Failed to update menu!');
                });
        }

        // Function to delete a menu
        function deleteMenu() {
            const deleteMenuId = document.getElementById('deleteMenuId').value;
            axios.delete(`http://rest-be/api/v1/restaurants/${deleteMenuId}`)
                .then((response) => {
                    console.log(response);
                    const deleteResultDiv = document.getElementById('deleteResult');
                    deleteResultDiv.innerHTML = JSON.stringify(response.data);
                    alert('Menu deleted successfully!');
                })
                .catch((error) => {
                    console.error(error);
                    alert('Failed to delete menu!');
                });
        }

        // Call getMenus() when the page loads to display all menus
        window.onload = function () {
            getMenus();
        }
    </script>
</body>

</html>